# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Товар

```
interface IProduct {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: string;
}
```

Данные по заказу

```
interface IOrder {
  id: string;
  total: number;
  payment: string;
  address: string;
  email: string; 
  phone: string; 
  items: IProduct[];
}
```

Интерфейс для модели данных товаров

```
interface IProductsList {
  total: number;
  items: IProduct[];
}
```

Данные пользователя, используемые в форме при оформлении заказа

```
export type TOrderInfo = Pick<IOrder, 'payment' | 'address'| 'email' | 'phone'>;
```

Данные по заказу, отображаемые в корзине перед началом оформления

```
export type TShop = Pick<IOrder, 'total' | 'items'>;
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:
- слой представления, отвечает за отображение данных на странице;
- слой данных, отвечает за хранение и изменение данных;
- презентер, отвечает за связь представления данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:
- 'get' - выполняет `GET` запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер;
- 'post' - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие;
- `emit` - инициализация события;
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие.

### Слой данных 

#### Класс ProductsData
Класс отвечает за хранение и логику работы с данными карточек товаров.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- _products: IProduct[] - массив объектов карточек товаров;
- _preview: string | null - id карточки, выбранной для просмотра в модальном окне;
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Также класс предоставляет набор методов для взаимодействия с этими данными.
- addProduct(product: IProduct): void; - добавление товара в корзину;
- deleteProduct(productId: string): void - удаляет выбранный товар из корзины;
- getProducts(): IProduct[]; - возвращает массив карточек товаров;
- checkProductsValidation(data: Record<keyof TShop, string>): boolean - проверяет объект с карточками на валидность;
- а также сеттеры и геттеры для сохранения и получения данных из полей класса.

#### Класс OrderData
Класс отвечает за хранение и логику работы с данными по заказу.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:
- id: string - id заказа;
- total: number - сумма заказа;
- payment: string - способ оплаты;
- address: string - адрес получателя;
- email: string - почта получателя; 
- phone: string - телефон получателя; 
- items: IProduct[] - массив выбранных товаров в заказе;
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Также класс предоставляет набор методов для взаимодействия с этими данными.
- setOrderInfo(orderData: IOrder): void - сохраняет данные заказа в классе;
- checkOrderValidation(data: Record<keyof TOrderInfo, string>): boolean - проверяет объект с данными заказа на валидность.

### Слой представления

Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Modal
Реализует модальное окно с формой содержащей данные. В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки. В классе кстанавливаются слушатели на все интерактивные элементы, в результате взаимодествия с которыми генерируются соответствующие события.\

Предоставляет методы для отображения ошибок и управления активностью кнопки сохранения. А также предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа. 
- constructor(container: HTMLElement, protected events: IEvents) - конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:
- modal: HTMLElement - элемент модального окна;
- submitButton: HTMLButtonElement - кнопка подтверждения;
- _form: HTMLFormElement - элемент формы;
- formName: string - значение атрибута name формы; 
- inputs: NodeListOf<HTMLInputElement> - коллекция всех полей ввода формы;
- errors: Record<string, HTMLElement> - объект хранящий все элементы для вывода ошибок под полями формы с привязкой к атрибуту name инпутов;
- events: IEvents - брокер событий.
Методы:
- setValid(isValid: boolean): void - изменяет активность кнопки подтверждения; 
- getInputValues(): Record<string, string> - возвращает объект с данными из полей формы, где ключ - name инпута, значение - данные введенные пользователем;
- setError(data{ field: string, value: string, validInformation: string }): void - принимает объект с данными для отображения или сокрытия текстов ошибок под полями ввода;
- showInputError (field: string, errorMessage: string): void - отображает полученный текст ошибки под указанным полем ввода;
- hideInputError (field: string): void - очищает текст ошибки под указазнным полем ввода;
- get form: HTMLElement - геттер для получения элемента формы;
- setProductData(productData: IProduct): void - заполняет атрибуты элементов карточки товара данными;
- render(): HTMLElement - метод возвращает полностью заполненную карточку товара;
- геттер id - возвращает уникальный id товара.

### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов

Код, описывающий взаимодействия представления и данных между собой находится в файле `index.ts`, выполняющий роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчика этих событий, описанных в `index.ts`.\
В `index.ts` сначала создается экземпляры всех необходимых классов, а затем настраивается обработка событий. 

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*
- `products:changed` - изменения массива карточек товара;
- `order:changed` - изменения данных о заказе;
- `product:selected` - изменение открываемой в модальном окне информации о товаре.

*Событие, возникающее при взаимодействии пользователя с интерфейсом (генерируется классами, отвечающим за представление)*
- `productInfo:open` - открытие модального окна с информацией по товару;
- `orderInfo:open` - открытие модального окна с информацией по заказу;
- `product:select` - выбор карточки товара для отображения в модальном окне;
- `producr:delete` - выбор товара для удаления из корзины;
- `orderDate:input` - изменение данных в форме с данными по заказу;
- `orderDate:submit` - сохранение данных по заказу;
- `productAdd:submit` - событие, генерируемое при добавлении товара в карзину;
- `orderDate:validation` - событие, сообщающее о необходимости валидации формы заказа.
- `orderDate:previewClear` - необходима очистка данных выбранной для показа в модальном окне карточки товара.